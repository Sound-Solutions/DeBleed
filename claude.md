# DeBleed - Neural Gate Plugin

A timbre-aware source enhancer VST3/AU plugin that uses neural networks to separate target audio from bleed/noise.

## Project Structure

```
DeBleed/
├── python/                    # Python training backend
│   ├── trainer.py            # Main training script with MaskEstimator network
│   ├── test_trainer.py       # Test script for validation
│   └── requirements.txt      # Python dependencies
├── plugin/Source/            # C++ JUCE plugin source
│   ├── PluginProcessor.*     # Main audio processor (STFT → neural → iSTFT)
│   ├── PluginEditor.*        # GUI with drop zones, progress bar, controls
│   ├── NeuralGateEngine.*    # ONNX Runtime inference wrapper
│   ├── STFTProcessor.*       # Real-time STFT/iSTFT (N_FFT=256, HOP=128)
│   ├── TrainerProcess.*      # Python subprocess management via IPC
│   └── AudioDropZone.*       # Drag-drop component for audio folders
├── Builds/MacOSX/            # Xcode project (generated by Projucer)
├── DeBleed.jucer             # Projucer project file
└── BUILD.md                  # Build instructions
```

## Architecture

### Signal Flow
1. Audio input → STFT (256-point FFT, 128 hop) → 129 frequency bins
2. Magnitude spectrum → MaskEstimator neural network → Ideal Ratio Mask
3. Apply mask to complex spectrum → iSTFT → output audio

### Neural Network (MaskEstimator)
- Input: `[batch, 1, n_freq_bins, n_frames]` magnitude spectrogram
- Encoder: 2 ConvBlocks with GroupNorm + GELU + Conv2d
- Temporal: 3 dilated convolutions (dilation 1, 2, 4)
- Decoder: Transposed convolutions back to input shape
- Output: Sigmoid mask (0-1) same shape as input

### Training Protocol
- Python trainer launched as subprocess from plugin
- Stdout parsing: `PROGRESS:XX`, `LOSS:X.XXX`, `STATUS:message`, `MODEL_PATH:path`
- Synthetic mixtures: clean + noise at random SNR (-5dB to +10dB)
- Loss: MSE between predicted mask and Ideal Ratio Mask

## Dependencies

### Python
- PyTorch, torchaudio, numpy, onnx, onnxruntime

### C++
- JUCE 7+ (from /Applications/JUCE)
- ONNX Runtime (install to ~/onnxruntime)

## Build Commands

```bash
# Python setup
cd python && pip3 install -r requirements.txt

# Plugin build (via Projucer)
/Applications/JUCE/Projucer.app/Contents/MacOS/Projucer --resave DeBleed.jucer
cd Builds/MacOSX && xcodebuild -configuration Debug
```

## Key Parameters

| Parameter | Range | Description |
|-----------|-------|-------------|
| Strength | 0-100% | Mask application intensity |
| Mix | 0-100% | Dry/wet blend |
| Bypass | On/Off | Disable processing |

## Latency

~5.33ms at 48kHz (256 samples FFT with 128 hop)
